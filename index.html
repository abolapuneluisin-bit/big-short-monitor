<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Big Short Monitor | Global Market Crash Gauge</title>
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0a0a0b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Crash Monitor">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        mono: ['JetBrains Mono', 'monospace'],
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        cyber: {
                            bg: '#0a0a0b',
                            card: '#141417',
                            primary: '#00f2ff',
                            secondary: '#7000ff',
                            danger: '#ff003c',
                            success: '#00ff66',
                            warning: '#ffcc00',
                            text: '#e2e2e2',
                            muted: '#888888',
                        }
                    },
                    animation: {
                        'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'flicker': 'flicker 0.1s infinite alternate',
                        'scanline': 'scanline 8s linear infinite',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer base {
            body {
                @apply bg-cyber-bg text-cyber-text font-sans overflow-x-hidden;
                background-image: 
                    radial-gradient(circle at 50% 50%, rgba(112, 0, 255, 0.05) 0%, transparent 50%),
                    linear-gradient(rgba(10, 10, 11, 0.95), rgba(10, 10, 11, 0.95)),
                    url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
            }
            .cyber-border {
                @apply border border-cyber-primary/20 hover:border-cyber-primary/50 transition-colors duration-300;
                box-shadow: 0 0 10px rgba(0, 242, 255, 0.05);
            }
            .cyber-panel {
                @apply bg-cyber-card p-6 rounded-lg cyber-border relative overflow-hidden;
            }
            .scanline {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 4px;
                background: rgba(0, 242, 255, 0.03);
                z-index: 100;
                pointer-events: none;
                animation: scanline 10s linear infinite;
            }
            @keyframes scanline {
                0% { transform: translateY(-100%); }
                100% { transform: translateY(100vh); }
            }
            @keyframes flicker {
                0% { opacity: 0.9; }
                100% { opacity: 1; }
            }
            .sniper-mode {
                @apply animate-flicker;
                --cyber-primary: #ff003c;
                --cyber-secondary: #ff003c;
            }
            .sniper-mode .cyber-border { @apply border-cyber-danger/50; }
            .sniper-mode .text-cyber-primary { @apply text-cyber-danger; }
            .sniper-mode .bg-cyber-primary { @apply bg-cyber-danger; }
        }
    </style>
</head>
<body>
    <div class="scanline"></div>

    <div id="main-container" class="max-w-7xl mx-auto px-4 py-8 lg:py-12">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-12 gap-6">
            <div class="flex items-center gap-4">
                <div class="w-3 h-12 bg-cyber-primary shadow-[0_0_15px_rgba(0,242,255,0.8)]"></div>
                <div>
                    <h1 class="text-3xl md:text-5xl font-black italic tracking-tighter uppercase leading-none">Big Short <span class="text-cyber-primary" id="monitor-title">Monitor</span></h1>
                    <p class="text-cyber-muted font-mono text-xs mt-1 uppercase tracking-widest">Global Recession Probability Index v4.0</p>
                </div>
            </div>
            
            <div class="flex items-center gap-6 font-mono">
                <div id="status-tag" class="flex items-center gap-2 px-3 py-1 bg-cyber-success/10 border border-cyber-success/30 rounded">
                    <span class="w-2 h-2 bg-cyber-success rounded-full animate-pulse"></span>
                    <span class="text-cyber-success text-[10px] uppercase font-bold">System Online</span>
                </div>
                <div class="text-right">
                    <div id="current-time" class="text-xl font-bold">12:34:56</div>
                    <div id="current-date" class="text-[10px] text-cyber-muted uppercase tracking-tighter">OCT 24 2025</div>
                </div>
            </div>
        </header>

        <!-- Main Dashboard Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 mb-12">
            
            <!-- Left Panel: Animated Gauge & Main Score -->
            <div class="lg:col-span-4 flex flex-col gap-6">
                <div class="cyber-panel flex flex-col items-center justify-center min-h-[400px]">
                    <h2 class="text-cyber-muted font-mono text-xs uppercase mb-8 self-start">Crash Probability Gauge</h2>
                    
                    <!-- Gauge SVG -->
                    <div class="relative w-64 h-64">
                        <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                            <!-- Background Circle -->
                            <circle cx="50" cy="50" r="45" fill="none" class="stroke-cyber-muted/10" stroke-width="8" />
                            <!-- Progress Circle -->
                            <circle id="gauge-progress" cx="50" cy="50" r="45" fill="none" stroke="currentColor" class="text-cyber-primary transition-all duration-1000 ease-out" stroke-width="8" stroke-dasharray="283" stroke-dashoffset="283" stroke-linecap="round" />
                        </svg>
                        
                        <!-- Center Data -->
                        <div class="absolute inset-0 flex flex-col items-center justify-center text-center">
                            <span id="crash-score-value" class="text-6xl font-black italic">42<span class="text-xl font-normal not-italic">%</span></span>
                            <span id="risk-level" class="text-[10px] uppercase font-bold tracking-widest text-cyber-primary mt-2">Moderate Risk</span>
                        </div>
                    </div>

                    <div class="mt-8 grid grid-cols-2 gap-4 w-full">
                        <div class="p-3 bg-white/5 rounded text-center">
                            <div class="text-[10px] text-cyber-muted uppercase">Sentiment</div>
                            <div class="text-sm font-bold text-cyber-warning uppercase" id="sentiment-val">NERVOUS</div>
                        </div>
                        <div class="p-3 bg-white/5 rounded text-center">
                            <div class="text-[10px] text-cyber-muted uppercase">Volatility</div>
                            <div class="text-sm font-bold text-cyber-primary uppercase" id="vol-val">HIGH</div>
                        </div>
                    </div>
                </div>

                <div class="cyber-panel bg-gradient-to-br from-cyber-card to-black">
                    <h2 class="text-cyber-muted font-mono text-xs uppercase mb-4">Buffett Indicator</h2>
                    <div class="flex items-end justify-between">
                        <div>
                            <div class="text-4xl font-black font-mono italic" id="buffett-val">198.4<span class="text-lg font-normal">%</span></div>
                            <div class="text-[10px] text-cyber-muted uppercase mt-1">Market Cap to GDP Ratio</div>
                        </div>
                        <div class="text-right">
                            <div class="text-cyber-danger text-xs font-bold font-mono">+12.4% vs AVG</div>
                            <div class="text-[8px] text-cyber-muted uppercase">Target: 225% (CRITICAL)</div>
                        </div>
                    </div>
                    <!-- Mini Progress Bar -->
                    <div class="w-full h-1 bg-white/10 mt-4 rounded-full overflow-hidden">
                        <div id="buffett-bar" class="h-full bg-cyber-secondary transition-all duration-1000" style="width: 88%"></div>
                    </div>
                </div>
            </div>

            <!-- Middle Panel: Technical Matrix -->
            <div class="lg:col-span-8">
                <div class="cyber-panel h-full">
                    <div class="flex justify-between items-start mb-8">
                        <div>
                            <h2 class="text-2xl font-black uppercase italic italic tracking-tighter">Market Technical Matrix</h2>
                            <p class="text-cyber-muted font-mono text-xs uppercase">Algorithm feedback from QQQ & T-BILLS</p>
                        </div>
                        <button onclick="toggleDemoMode()" id="data-source-btn" class="px-3 py-1 bg-cyber-primary/10 border border-cyber-primary/30 rounded text-[10px] text-cyber-primary uppercase font-bold hover:bg-cyber-primary/20 transition-all">
                            Live: DEMO MODE
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- QQQ Card -->
                        <div class="p-4 bg-white/5 cyber-border rounded-lg relative group">
                            <div class="text-xs text-cyber-muted uppercase font-mono mb-2">Ticker: QQQ</div>
                            <div class="text-3xl font-black font-mono tracking-tighter" id="qqq-price">$482.12</div>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-cyber-danger text-xs font-bold" id="qqq-change">-1.42%</span>
                                <span class="text-[10px] text-cyber-muted uppercase">24H Change</span>
                            </div>
                            <div class="mt-4 pt-4 border-t border-white/5 space-y-2">
                                <div class="flex justify-between text-[10px] uppercase font-mono">
                                    <span>SMA 200</span>
                                    <span id="sma-val" class="text-cyber-success font-bold">$442.50</span>
                                </div>
                                <div class="flex justify-between text-[10px] uppercase font-mono">
                                    <span>RSI (14)</span>
                                    <span id="rsi-val" class="text-cyber-warning font-bold">68.4</span>
                                </div>
                            </div>
                        </div>

                        <!-- T-Bill Card -->
                        <div class="p-4 bg-white/5 cyber-border rounded-lg relative group">
                            <div class="text-xs text-cyber-muted uppercase font-mono mb-2">10Y Treasury Yield</div>
                            <div class="text-3xl font-black font-mono tracking-tighter" id="tbill-yield">4.21<span class="text-lg font-normal">%</span></div>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-cyber-success text-xs font-bold" id="tbill-change">+0.05</span>
                                <span class="text-[10px] text-cyber-muted uppercase">BPS Change</span>
                            </div>
                            <div class="mt-4 pt-4 border-t border-white/5 space-y-2">
                                <div class="flex justify-between text-[10px] uppercase font-mono">
                                    <span>Inflation Adj</span>
                                    <span class="text-cyber-primary font-bold">1.8%</span>
                                </div>
                                <div class="flex justify-between text-[10px] uppercase font-mono">
                                    <span>Yield Curve</span>
                                    <span id="curve-status" class="text-cyber-danger font-bold">INVERTED</span>
                                </div>
                            </div>
                        </div>

                        <!-- Market Health -->
                        <div class="p-4 bg-white/5 cyber-border rounded-lg relative group overflow-hidden">
                            <div class="absolute top-0 right-0 w-24 h-24 bg-cyber-primary/5 rounded-full -mr-12 -mt-12"></div>
                            <div class="text-xs text-cyber-muted uppercase font-mono mb-2">Liquidity Index</div>
                            <div class="text-3xl font-black font-mono tracking-tighter italic">BRAVO-6</div>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="px-2 py-0.5 bg-cyber-danger/20 text-cyber-danger rounded text-[8px] font-bold uppercase">Critical</span>
                                <span class="text-[10px] text-cyber-muted uppercase font-mono">Fed Inject: NO</span>
                            </div>
                            <div class="mt-6 flex flex-col gap-1">
                                <div class="flex justify-between items-center text-[8px] uppercase font-mono text-cyber-muted">
                                    <span>Stress level</span>
                                    <span>High</span>
                                </div>
                                <div class="w-full h-1 bg-white/10 rounded-full">
                                    <div class="h-full bg-cyber-danger w-4/5"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Mini Chart Visualization -->
                    <div class="mt-6 p-4 bg-black/40 border border-white/5 rounded-lg">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-[10px] uppercase tracking-widest text-cyber-muted font-bold">Real-time Entropy Stream</h3>
                            <div class="flex gap-2">
                                <div class="w-1.5 h-1.5 bg-cyber-primary rounded-full animate-pulse"></div>
                                <div class="w-1.5 h-1.5 bg-cyber-primary/40 rounded-full animate-pulse [animation-delay:200ms]"></div>
                                <div class="w-1.5 h-1.5 bg-cyber-primary/20 rounded-full animate-pulse [animation-delay:400ms]"></div>
                            </div>
                        </div>
                        <div id="entropy-stream" class="h-24 flex items-end gap-1 px-2">
                            <!-- Dynamic Bars injected by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Guru Section -->
        <div class="mb-12">
            <h2 class="text-2xl font-black uppercase italic italic tracking-tighter mb-8 flex items-center gap-4">
                <span class="w-8 h-px bg-cyber-primary"></span>
                The Oracle Matrix
                <span class="flex-grow h-px bg-white/5"></span>
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-6" id="guru-grid">
                <!-- Buffett -->
                <div class="group">
                    <div class="relative mb-4">
                        <div class="w-full aspect-square bg-white/5 cyber-border rounded-xl grayscale group-hover:grayscale-0 transition-all duration-500 overflow-hidden flex items-center justify-center">
                            <span class="text-4xl text-cyber-muted opacity-20 font-black">WB</span>
                        </div>
                        <div class="absolute -bottom-2 -right-2 px-3 py-1 bg-cyber-bg cyber-border text-[9px] font-bold uppercase tracking-widest">Warren Buffett</div>
                    </div>
                    <div class="relative p-4 bg-white/5 border border-white/10 rounded-lg text-xs leading-relaxed italic text-cyber-muted group-hover:text-cyber-text transition-colors">
                        "Be fearful when others are greedy. The indicator is screaming now."
                        <div class="absolute -top-1.5 left-4 w-3 h-3 bg-white/5 border-l border-t border-white/10 rotate-45"></div>
                    </div>
                </div>

                <!-- Burry -->
                <div class="group">
                    <div class="relative mb-4">
                        <div class="w-full aspect-square bg-white/5 cyber-border rounded-xl grayscale group-hover:grayscale-0 transition-all duration-500 overflow-hidden flex items-center justify-center">
                            <span class="text-4xl text-cyber-muted opacity-20 font-black">MB</span>
                        </div>
                        <div class="absolute -bottom-2 -right-2 px-3 py-1 bg-cyber-bg cyber-border text-[9px] font-bold uppercase tracking-widest">Michael Burry</div>
                    </div>
                    <div class="relative p-4 bg-white/5 border border-white/10 rounded-lg text-xs leading-relaxed italic text-cyber-muted group-hover:text-cyber-text transition-colors">
                        "Small caps are a bubble. Index funds are a bubble. History repeats."
                        <div class="absolute -top-1.5 left-4 w-3 h-3 bg-white/5 border-l border-t border-white/10 rotate-45"></div>
                    </div>
                </div>

                <!-- Nicolelis -->
                <div class="group">
                    <div class="relative mb-4">
                        <div class="w-full aspect-square bg-white/5 cyber-border rounded-xl grayscale group-hover:grayscale-0 transition-all duration-500 overflow-hidden flex items-center justify-center">
                            <span class="text-4xl text-cyber-muted opacity-20 font-black">MN</span>
                        </div>
                        <div class="absolute -bottom-2 -right-2 px-3 py-1 bg-cyber-bg cyber-border text-[9px] font-bold uppercase tracking-widest">Miguel Nicolelis</div>
                    </div>
                    <div class="relative p-4 bg-white/5 border border-white/10 rounded-lg text-xs leading-relaxed italic text-cyber-muted group-hover:text-cyber-text transition-colors">
                        "Technological singularity meets economic fragility. Systems failing."
                        <div class="absolute -top-1.5 left-4 w-3 h-3 bg-white/5 border-l border-t border-white/10 rotate-45"></div>
                    </div>
                </div>

                <!-- Fakhoury -->
                <div class="group">
                    <div class="relative mb-4">
                        <div class="w-full aspect-square bg-white/5 cyber-border rounded-xl grayscale group-hover:grayscale-0 transition-all duration-500 overflow-hidden flex items-center justify-center">
                            <span class="text-4xl text-cyber-muted opacity-20 font-black">SF</span>
                        </div>
                        <div class="absolute -bottom-2 -right-2 px-3 py-1 bg-cyber-bg cyber-border text-[9px] font-bold uppercase tracking-widest">S. Fakhoury</div>
                    </div>
                    <div class="relative p-4 bg-white/5 border border-white/10 rounded-lg text-xs leading-relaxed italic text-cyber-muted group-hover:text-cyber-text transition-colors">
                        "The debt supercycle is entering its terminal phase. Protect capital."
                        <div class="absolute -top-1.5 left-4 w-3 h-3 bg-white/5 border-l border-t border-white/10 rotate-45"></div>
                    </div>
                </div>

                <!-- Dalio -->
                <div class="group">
                    <div class="relative mb-4">
                        <div class="w-full aspect-square bg-white/5 cyber-border rounded-xl grayscale group-hover:grayscale-0 transition-all duration-500 overflow-hidden flex items-center justify-center">
                            <span class="text-4xl text-cyber-muted opacity-20 font-black">RD</span>
                        </div>
                        <div class="absolute -bottom-2 -right-2 px-3 py-1 bg-cyber-bg cyber-border text-[9px] font-bold uppercase tracking-widest">Ray Dalio</div>
                    </div>
                    <div class="relative p-4 bg-white/5 border border-white/10 rounded-lg text-xs leading-relaxed italic text-cyber-muted group-hover:text-cyber-text transition-colors">
                        "The changing world order suggests a Great Deleveraging ahead."
                        <div class="absolute -top-1.5 left-4 w-3 h-3 bg-white/5 border-l border-t border-white/10 rotate-45"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Logs Footer -->
        <footer class="cyber-panel p-4 mt-auto">
            <div class="flex justify-between items-center mb-2">
                <span class="text-[10px] uppercase font-bold text-cyber-muted">Kernel Access Logs</span>
                <span class="text-[10px] font-mono text-cyber-primary">0.002ms Latency</span>
            </div>
            <div id="logs" class="font-mono text-[9px] text-cyber-muted space-y-1 h-32 overflow-y-auto custom-scrollbar">
                <!-- Logs injected by JS -->
            </div>
        </footer>
    </div>

    <!-- Sniper Overlay (Hidden by default) -->
    <div id="sniper-overlay" class="fixed inset-0 pointer-events-none opacity-0 transition-opacity duration-300 z-50">
        <div class="absolute inset-0 border-[20px] border-cyber-danger/30 animate-pulse"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center">
            <div class="text-[120px] font-black italic text-cyber-danger/10 uppercase select-none">CRITICAL</div>
        </div>
    </div>

    <script>
        // --- State Management ---
        let state = {
            isDemoMode: true,
            apiKeys: {
                alphaVantage: '',
                finnhub: ''
            },
            data: {
                qqqPrice: 482.12,
                qqqChange: -1.42,
                tbillYield: 4.21,
                tbillChange: 0.05,
                buffettIndicator: 198.4,
                rsi: 68.4,
                sma200: 442.50,
                crashScore: 42,
                sentiment: 'NERVOUS'
            },
            logs: []
        };

        // --- Core Logic ---

        function calculateCrashScore() {
            // Sniper Logic: Based on several factors
            // 1. Buffett Indicator (Max 225%)
            // 2. RSI (Overbought > 70 adds risk)
            // 3. Distance from SMA 200 (Overextended > 10% adds risk)
            // 4. Yield Curve (Inverted = +25% score)
            
            let score = 0;
            
            // Buffett Weight (0-40 points)
            const buffettRatio = Math.min(state.data.buffettIndicator / 225, 1);
            score += buffettRatio * 40;
            
            // RSI Weight (0-20 points)
            if (state.data.rsi > 70) score += 20;
            else if (state.data.rsi > 60) score += 10;
            
            // T-Bill / Interest Rate Pressure (0-20 points)
            if (state.data.tbillYield > 4.5) score += 20;
            else if (state.data.tbillYield > 4) score += 10;
            
            // Random Market Entropy (0-20 points)
            score += Math.random() * 20;
            
            state.data.crashScore = Math.min(Math.round(score), 100);
            
            // Update Sentiment
            if (state.data.crashScore > 75) state.data.sentiment = 'CRITICAL';
            else if (state.data.crashScore > 50) state.data.sentiment = 'FEARFUL';
            else if (state.data.crashScore > 30) state.data.sentiment = 'NERVOUS';
            else state.data.sentiment = 'CAUTIOUS';
            
            updateUI();
        }

        function updateUI() {
            const isSniper = state.data.crashScore > 75;
            document.body.classList.toggle('sniper-mode', isSniper);
            document.getElementById('sniper-overlay').style.opacity = isSniper ? '1' : '0';
            document.getElementById('monitor-title').innerText = isSniper ? 'DANGER' : 'Monitor';

            // Gauge Update
            const progressCircle = document.getElementById('gauge-progress');
            const circumference = 2 * Math.PI * 45;
            const offset = circumference - (state.data.crashScore / 100) * circumference;
            progressCircle.style.strokeDashoffset = offset;
            
            document.getElementById('crash-score-value').innerHTML = `${state.data.crashScore}<span class="text-xl font-normal not-italic">%</span>`;
            document.getElementById('risk-level').innerText = state.data.sentiment + ' RISK';
            
            // Prices & Yields
            document.getElementById('qqq-price').innerText = `$${state.data.qqqPrice.toFixed(2)}`;
            document.getElementById('qqq-change').innerText = `${state.data.qqqChange > 0 ? '+' : ''}${state.data.qqqChange.toFixed(2)}%`;
            document.getElementById('qqq-change').className = `text-xs font-bold ${state.data.qqqChange >= 0 ? 'text-cyber-success' : 'text-cyber-danger'}`;
            
            document.getElementById('tbill-yield').innerHTML = `${state.data.tbillYield.toFixed(2)}<span class="text-lg font-normal">%</span>`;
            document.getElementById('buffett-val').innerHTML = `${state.data.buffettIndicator.toFixed(1)}<span class="text-lg font-normal">%</span>`;
            document.getElementById('buffett-bar').style.width = `${Math.min(state.data.buffettIndicator / 2.25, 100)}%`;
            
            document.getElementById('rsi-val').innerText = state.data.rsi.toFixed(1);
            document.getElementById('sentiment-val').innerText = state.data.sentiment;
            
            if (isSniper) {
                log('CRITICAL ALERT: Market instability detected. Score exceeding 75%.');
            }
        }

        function toggleDemoMode() {
            state.isDemoMode = !state.isDemoMode;
            document.getElementById('data-source-btn').innerText = state.isDemoMode ? 'Live: DEMO MODE' : 'Live: API CONNECTED';
            log(`Mode switched: ${state.isDemoMode ? 'Simulating' : 'Attempting API Connection'}`);
        }

        function log(msg) {
            const time = new Date().toLocaleTimeString('en-US', { hour12: false });
            const logEntry = `<div class="mb-1"><span class="text-cyber-primary">[${time}]</span> ${msg}</div>`;
            const logsContainer = document.getElementById('logs');
            logsContainer.innerHTML = logEntry + logsContainer.innerHTML;
            if (logsContainer.children.length > 50) logsContainer.lastElementChild.remove();
        }

        // --- Demo Simulation Loop ---
        function runSimulation() {
            if (!state.isDemoMode) return;
            
            // Subtle price movements
            state.data.qqqPrice += (Math.random() - 0.5) * 0.5;
            state.data.qqqChange = (Math.random() - 0.5) * 2;
            state.data.tbillYield += (Math.random() - 0.5) * 0.01;
            state.data.rsi += (Math.random() - 0.5) * 1;
            state.data.rsi = Math.max(20, Math.min(85, state.data.rsi));
            
            // Random spike for demo "Sniper Logic"
            if (Math.random() > 0.98) {
                state.data.buffettIndicator += 5;
                log('DATA SPIKE: Institutional sell-off detected (SIMULATED)');
            } else {
                state.data.buffettIndicator += (Math.random() - 0.5) * 0.2;
            }

            calculateCrashScore();
            addEntropyBar();
        }

        function addEntropyBar() {
            const stream = document.getElementById('entropy-stream');
            const h = Math.random() * 100;
            const bar = document.createElement('div');
            bar.className = 'flex-grow bg-cyber-primary/20 hover:bg-cyber-primary transition-all duration-300';
            bar.style.height = `${h}%`;
            stream.appendChild(bar);
            if (stream.children.length > 40) stream.firstElementChild.remove();
        }

        // --- Initialization ---
        function init() {
            log('Initializing Big Short Kernel...');
            log('Loading PWA Service Worker...');
            log('Fetching Market Vectors...');
            
            setInterval(() => {
                const now = new Date();
                document.getElementById('current-time').innerText = now.toLocaleTimeString('en-US', { hour12: false });
                document.getElementById('current-date').innerText = now.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }).toUpperCase();
            }, 1000);

            // Initial bars
            for(let i=0; i<40; i++) addEntropyBar();

            calculateCrashScore();
            setInterval(runSimulation, 2000);
            
            // Register SW
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js').then(() => {
                    log('PWA Service Worker registered.');
                });
            }
        }

        window.onload = init;
    </script>
</body>
</html>
